
<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>จองที่นั่งรถตู้</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body {
    font-family: sans-serif;
    text-align: center;
    padding: 16px;
    background: #f5f5f5;
  }
  .container {
    max-width: 480px;
    margin: auto;
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  }
  .title {
    font-size: 22px;
    font-weight: bold;
  }
  .logo {
    width: 150px;
    margin: 5px auto;
    display: block;
  }
  .field-label {
    text-align: left;
    margin-top: 12px;
    font-weight: bold;
    font-size: 14px;
  }
  .field-input {
    width: 100%;
    padding: 10px;
    margin-top: 4px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(3, 70px);
    gap: 10px;
    justify-content: center;
    margin-top: 15px;
  }

  .seat {
    width: 70px;
    height: 70px;
    border-radius: 8px;
    font-size: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    background: #4CAF50;
    color: white;
    font-weight: bold;
  }
  .seat.selected {
    background: gold;
    color: black;
  }
  .seat.booked {
    background: #e53935;
    color: white;
    cursor: not-allowed;
  }

  button {
    width: 100%;
    margin-top: 15px;
    padding: 12px;
    border: none;
    border-radius: 8px;
    background: #1976d2;
    color: white;
    font-size: 16px;
    font-weight: bold;
  }
  .hidden { display: none; }
</style>
</head>

<body>

<div class="container">

  <h1 class="title">ระบบจองที่นั่งรถตู้</h1>

  <!-- ไอซ์ต้องมั่นใจว่าไฟล์พวกนี้อยู่ในโฟลเดอร์เดียวกับ index.html -->
  <img src="เที่ย นี่เหอะ.png" class="logo">
  <img src="IMG_0444.jpeg" class="logo">

  <label class="field-label">วันที่เดินทาง</label>
  <input id="date" type="date" class="field-input">

  <label class="field-label">ชื่อทริป</label>
  <input id="trip" type="text" class="field-input" placeholder="เช่น ผ้าห่มปก">

  <div id="seatGrid" class="grid"></div>

  <div id="formBox" class="hidden">
    <label class="field-label">ชื่อ-นามสกุล</label>
    <input id="name" class="field-input">

    <label class="field-label">เบอร์โทร</label>
    <input id="phone" class="field-input">

    <label class="field-label">ไลน์ไอดี</label>
    <input id="line" class="field-input">

    <button id="submitBtn">ยืนยันการจอง</button>
  </div>

</div>

<script>

  // ⛔ ใช้ URL เดิมของไอซ์ ไม่ได้เปลี่ยน
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwq_wamcsBHOnEWZZba2onoX6lvczQ1ghkyia608cZjjzuwbTc2ZGS28NPAgcDjFoZA/exec";

  const seats = [3,6,9,2,5,8,1,4,7];
  let selectedSeat = null;

  document.getElementById("date").addEventListener("change", loadBooked);
  document.getElementById("submitBtn").addEventListener("click", submitBooking);

  // โหลดเบาะที่จองแล้วจาก Google Sheet
  function loadBooked() {
    const date = document.getElementById("date").value;
    if (!date) return;

    fetch(`${SCRIPT_URL}?action=read&date=${date}`)
      .then(res => res.json())
      .then(data => showSeats(data.booked || []))
      .catch(err => console.log("โหลดข้อมูล error:", err));
  }

  // แสดงผังเบาะ
  function showSeats(booked) {
    const grid = document.getElementById("seatGrid");
    grid.innerHTML = "";
    document.getElementById("formBox").classList.add("hidden");
    selectedSeat = null;

    seats.forEach(num => {
      const div = document.createElement("div");
      div.className = "seat";
      div.textContent = num;

      if (booked.includes(String(num))) {
        div.classList.add("booked"); // สีแดง
      } else {
        div.addEventListener("click", () => selectSeat(div));
      }

      grid.appendChild(div);
    });
  }

  function selectSeat(el) {
    if (el.classList.contains("booked")) return;

    document.querySelectorAll(".seat").forEach(s => {
      if (!s.classList.contains("booked")) s.classList.remove("selected");
    });

    el.classList.add("selected");
    selectedSeat = el.textContent;
    document.getElementById("formBox").classList.remove("hidden");
  }

  function submitBooking() {
    const date = document.getElementById("date").value;
    const trip = document.getElementById("trip").value.trim();
    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const line = document.getElementById("line").value.trim();

    if (!date || !trip || !selectedSeat || !name || !phone || !line) {
      alert("กรุณากรอกข้อมูลให้ครบ");
      return;
    }

    // ส่งแบบฟอร์ม (กัน CORS)
    const form = document.createElement("form");
    form.method = "POST";
    form.action = SCRIPT_URL;
    form.target = "_blank";

    const data = { date, trip, seat:selectedSeat, name, phone, line };
    for (let k in data) {
      const input = document.createElement("input");
      input.type = "hidden";
      input.name = k;
      input.value = data[k];
      form.appendChild(input);
    }

    document.body.appendChild(form);
    form.submit();
    form.remove();

    alert("ส่งคำจองแล้ว!");
    loadBooked(); // รีเฟรชสีแดง
  }

</script>

</body>
</html>
