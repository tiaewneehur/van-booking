
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏£‡∏ñ‡∏ï‡∏π‡πâ</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
:root{
  --green:#4CAF50; --red:#E53935; --yellow:#FDD835; --bg:#f2f4f7;
  --card:#fff; --muted:#777;
}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto; background:var(--bg); padding:16px;}
.card{max-width:520px;margin:0 auto;background:var(--card);border-radius:14px;padding:18px;box-shadow:0 8px 30px rgba(0,0,0,0.06);}
.title{text-align:center;font-size:22px;font-weight:700;margin:2px 0 6px;}
.subtitle{text-align:center;color:var(--muted);font-size:13px;margin-bottom:12px;}
.logo{display:block;margin:8px auto 12px;max-width:220px;width:70%;}
.seat-map-img{display:block;margin:6px auto 12px;max-width:280px;width:85%;border-radius:8px;}
.field-label{font-weight:600;margin:10px 0 6px;display:block;}
.field-input{width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;box-sizing:border-box;font-size:15px;}
.grid{display:grid;grid-template-columns:repeat(3,90px);gap:12px;justify-content:center;margin-top:14px;margin-bottom:12px;}

/* ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ ‡πÑ‡∏°‡πà‡∏•‡πâ‡∏ô ‡πÑ‡∏°‡πà‡πÄ‡∏î‡πâ‡∏á */
.seat{
  width:90px;
  height:90px;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:17px;     /* ‡∏à‡∏≤‡∏Å 26px ‚Üí 17px */
  font-weight:600;    /* ‡∏ô‡∏∏‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
  color:#fff;
  cursor:pointer;
  padding:4px;        /* ‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö */
  line-height:1.2;
  white-space:nowrap; /* ‡∏Å‡∏±‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà */
  box-shadow:0 6px 14px rgba(0,0,0,0.06);
  transition:transform .12s;
}

.seat:hover{transform:translateY(-4px)}
.seat.empty{background:var(--green)}
.seat.booked{background:var(--red);cursor:not-allowed;transform:none;box-shadow:none}
.seat.selected{background:var(--yellow);color:#000}

.legend{display:flex;gap:10px;align-items:center;justify-content:center;margin-top:10px;font-size:13px;color:var(--muted)}
.legend .box{width:14px;height:14px;border-radius:3px;display:inline-block;margin-right:6px;vertical-align:middle}
.btn{display:block;width:100%;padding:12px;border-radius:10px;border:0;background:#1976d2;color:#fff;font-weight:700;font-size:15px;cursor:pointer;margin-top:10px}
.note{font-size:13px;color:var(--muted);text-align:center;margin-top:8px}
.hidden{display:none}

/* üì± Responsive: ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏á‡∏≠‡∏µ‡∏Å‡πÉ‡∏ô‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å */
@media (max-width:420px){
  .grid{grid-template-columns:repeat(3,72px);gap:10px}
  .seat{
    width:72px;
    height:72px;
    font-size:13px;   /* ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    padding:3px;
  }
}
  </style>
</head>
<body>

<div class="card">
  <h1 class="title">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏£‡∏ñ‡∏ï‡∏π‡πâ</h1>
  <p class="subtitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏¥‡∏õ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ö‡∏≤‡∏∞ ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö</p>

  <!-- ‡∏ß‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ 2 ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô repo: ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ -->
  <img src="‡πÄ‡∏ó‡∏µ‡πà‡∏¢ ‡∏ô‡∏µ‡πà‡πÄ‡∏´‡∏≠‡∏∞.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ" class="logo" />
  <img src="IMG_0444.jpeg" alt="‡∏ú‡∏±‡∏á‡πÄ‡∏ö‡∏≤‡∏∞" class="seat-map-img" />

  <form id="bookingForm" method="POST" target="_blank">
    <label class="field-label" for="date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</label>
    <input id="date" name="date" type="date" class="field-input" required />

    <label class="field-label" for="trip">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏¥‡∏õ</label>
    <input id="trip" name="trip" type="text" class="field-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡πâ‡∏≤‡∏´‡πà‡∏°‡∏õ‡∏Å" required />

    <div id="seatGrid" class="grid" aria-hidden="false"></div>

    <input id="seatField" name="seat" type="hidden" />

    <div id="formBox" class="hidden">
      <label class="field-label" for="name">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
      <input id="name" name="name" type="text" class="field-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏¢‡πÄ‡∏î‡∏¥‡∏ô‡∏õ‡πà‡∏≤ ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ô‡∏µ‡πà‡πÄ‡∏´‡∏≠‡∏∞" required />

      <label class="field-label" for="nickname">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô (‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏ú‡∏±‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß)</label>
      <input id="nickname" name="nickname" type="text" class="field-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏≠‡∏ã‡πå" required />

      <label class="field-label" for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
      <input id="phone" name="phone" type="tel" class="field-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 080-000-0000" required />

      <label class="field-label" for="line">‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏•‡∏ô‡πå (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠)</label>
      <input id="line" name="line" type="text" class="field-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ô‡∏µ‡πà‡πÄ‡∏´‡∏≠‡∏∞" required />

      <button type="submit" class="btn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
      <p class="note">‡πÄ‡∏ö‡∏≤‡∏∞‡∏™‡∏µ‡πÅ‡∏î‡∏á = ‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô) ‚Ä¢ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß = ‡∏ß‡πà‡∏≤‡∏á ‚Ä¢ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á = ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
    </div>
  </form>

  <div class="legend" aria-hidden="true">
    <span><span class="box" style="background:var(--green)"></span>‡∏ß‡πà‡∏≤‡∏á</span>
    <span><span class="box" style="background:var(--yellow)"></span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
    <span><span class="box" style="background:var(--red)"></span>‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>
  </div>
</div>

<script>
/* ====== ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤: ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏Ç‡∏≠‡∏á Web App ‡∏ó‡∏µ‡πà deploy ‡∏Ç‡∏≠‡∏á‡πÑ‡∏≠‡∏ã‡πå ====== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw7OvKq9CZ2bgRI61UpGVTCqYYSm4xSz4DcDwkwEaTXG0yfhldX34Bmnqi5m7y6cnS-/exec";
const READ_URL = SCRIPT_URL + "?action=read";

/* layout ‡πÄ‡∏ö‡∏≤‡∏∞ */
const SEATS = [3,6,9,2,5,8,1,4,7];

let selectedSeat = null;

/* JSONP loader (load booked seats for selected date) */
function loadBookedJSONP(date, callback) {
  if (!date) { callback([]); return; }
  const cbName = "cb_" + Date.now() + "_" + Math.floor(Math.random()*9999);
  window[cbName] = function(data){
    try { callback(data && data.bookings ? data.bookings : []); }
    finally { delete window[cbName]; const s = document.getElementById(cbName); if (s) s.remove(); }
  };
  const script = document.createElement('script');
  script.id = cbName;
  script.src = READ_URL + "&date=" + encodeURIComponent(date) + "&callback=" + cbName;
  script.onerror = function(){ delete window[cbName]; script.remove(); callback([]); };
  document.body.appendChild(script);
  setTimeout(()=>{ if (window[cbName]) { delete window[cbName]; script.remove(); callback([]); } }, 5000);
}

/* render ‡∏ú‡∏±‡∏á‡πÄ‡∏ö‡∏≤‡∏∞‡∏ï‡∏≤‡∏° bookedArray */
function renderSeats(bookedArray) {
  const grid = document.getElementById('seatGrid');
  grid.innerHTML = '';
  selectedSeat = null;
  document.getElementById('seatField').value = '';
  document.getElementById('formBox').classList.add('hidden');

  const bookedMap = {};
  (bookedArray || []).forEach(b => {
    if (b && b.seat) bookedMap[String(b.seat)] = b.nickname || '‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß';
  });

  SEATS.forEach(n => {
    const div = document.createElement('div');
    div.classList.add('seat');
    const sKey = String(n);
    if (bookedMap[sKey]) {
      div.classList.add('booked');
      div.textContent = bookedMap[sKey];
      div.title = "‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß: " + bookedMap[sKey];
    } else {
      div.classList.add('empty');
      div.textContent = sKey;
      div.addEventListener('click', () => onClickSeat(div, sKey));
    }
    grid.appendChild(div);
  });
}

/* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏ö‡∏≤‡∏∞ */
function onClickSeat(div, sKey) {
  const date = document.getElementById('date').value;
  const trip = document.getElementById('trip').value.trim();
  if (!date) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô'); return; }
  if (!trip) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏¥‡∏õ‡∏Å‡πà‡∏≠‡∏ô'); return; }
  document.querySelectorAll('.seat').forEach(s => s.classList.remove('selected'));
  div.classList.add('selected');
  selectedSeat = sKey;
  document.getElementById('seatField').value = sKey;
  document.getElementById('formBox').classList.remove('hidden');
  setTimeout(()=>{ const el = document.getElementById('name'); if(el) el.focus(); }, 120);
}

/* ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏±‡∏ô */
function onDateChange() {
  const date = document.getElementById('date').value;
  if (!date) { renderSeats([]); return; }
  loadBookedJSONP(date, function(booked){
    renderSeats(booked);
  });
}

/* ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡πà‡∏≠‡∏ô submit (form ‡∏à‡∏∞ submit ‡πÄ‡∏õ‡πá‡∏ô POST ‡πÑ‡∏õ SCRIPT_URL) */
function onSubmit(e) {
  const date = document.getElementById('date').value;
  const trip = document.getElementById('trip').value.trim();
  const seat = document.getElementById('seatField').value;
  const name = document.getElementById('name').value.trim();
  const nickname = document.getElementById('nickname').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const line = document.getElementById('line').value.trim();

  if (!date || !trip || !seat || !name || !nickname || !phone || !line) {
    e.preventDefault();
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ö‡∏≤‡∏∞');
    return false;
  }
  // optimistic reload ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡∏•‡∏±‡∏á submit ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
  setTimeout(()=> onDateChange(), 900);
  return true;
}

/* init */
document.addEventListener('DOMContentLoaded', function(){
  const form = document.getElementById('bookingForm');
  form.action = SCRIPT_URL;
  document.getElementById('date').addEventListener('change', onDateChange);
  form.addEventListener('submit', function(e){ if (!onSubmit(e)) return false; });
  renderSeats([]);
});
</script>

</body>
</html>
