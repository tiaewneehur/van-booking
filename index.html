
<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<title>จองที่นั่งรถตู้</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<style>
:root{
  --green:#4CAF50; --red:#E53935; --yellow:#FDD835; --bg:#f2f4f7;
  --card:#fff; --muted:#777;
}
body{margin:0;font-family:system-ui;background:var(--bg);padding:16px;}
.card{max-width:520px;margin:auto;background:#fff;border-radius:14px;padding:18px;}
.title{text-align:center;font-size:22px;font-weight:700;}
.subtitle{text-align:center;color:#777;font-size:13px;margin-bottom:12px;}
.logo{display:block;margin:8px auto 12px;max-width:220px;width:70%;}
.seat-map-img{display:block;margin:6px auto 12px;max-width:280px;width:85%;}
.field-label{font-weight:600;margin:10px 0 6px;display:block;}
.field-input{width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;}
.grid{display:grid;grid-template-columns:repeat(3,90px);gap:12px;justify-content:center;margin:14px 0;}
.seat{width:90px;height:90px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff}
.seat.empty{background:#4CAF50;cursor:pointer}
.seat.booked{background:#E53935}
.seat.selected{background:#FDD835;color:#000}
.bank-box{border:2px dashed #1976d2;border-radius:12px;padding:15px;margin:15px 0;text-align:center}
.btn{width:100%;padding:14px;border-radius:12px;border:0;background:#1e88e5;color:#fff;font-weight:700;margin-top:15px}
.hidden{display:none}
.legend{text-align:center;font-size:13px;color:#777;margin-top:10px}
</style>
</head>

<body>
<div class="card">
<h1 class="title">ระบบจองที่นั่งรถตู้</h1>
<p class="subtitle">เลือกวัน กรอกชื่อทริป เลือกเบาะ เติมข้อมูลให้ครบ</p>

<img src="เที่ย นี่เหอะ.png" class="logo">
<img src="IMG_0444.jpeg" class="seat-map-img">

<form id="bookingForm">
<label class="field-label">วันที่เดินทาง</label>
<input type="date" id="date" name="date" class="field-input" required>

<label class="field-label">ชื่อทริป</label>
<input type="text" id="trip" name="trip" class="field-input" required>

<div id="seatGrid" class="grid"></div>
<input type="hidden" id="seatField" name="seat">

<div id="formBox" class="hidden">
<label class="field-label">ชื่อ-นามสกุล</label>
<input name="name" class="field-input" required>

<label class="field-label">ชื่อเล่น</label>
<input name="nickname" class="field-input" required>

<label class="field-label">เบอร์โทร</label>
<input name="phone" class="field-input" required>

<label class="field-label">ไลน์</label>
<input name="line" class="field-input" required>

<div class="bank-box">
<p>ธนาคารทหารไทยธนชาต (TTB)</p>
<p style="font-size:26px;color:#d32f2f;font-weight:800;">442-2-61447-1</p>
<p>ชื่อบัญชี: วิชาญ นาคะลัย</p>

<input name="amount" value="1000" readonly class="field-input" style="margin-top:10px">
<input type="file" id="slipFile" accept="image/*" class="field-input" required>
<input type="hidden" id="slipBase64" name="slipBase64">
</div>

<button class="btn" id="submitBtn">ยืนยันการจองและส่งสลิป</button>
</div>
</form>

<div class="legend">
เขียว = ว่าง • เหลือง = เลือก • แดง = จองแล้ว
</div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw7OvKq9CZ2bgRI61UpGVTCqYYSm4xSz4DcDwkwEaTXG0yfhldX34Bmnqi5m7y6cnS-/exec";
const READ_URL = SCRIPT_URL + "?action=read";
const SEATS = [3,6,9,2,5,8,1,4,7];

// --- base64 ---
document.getElementById('slipFile').addEventListener('change',function(){
  const r=new FileReader();
  r.onload=()=>slipBase64.value=r.result;
  r.readAsDataURL(this.files[0]);
});

// --- render seats ---
function renderSeats(booked=[]){
  seatGrid.innerHTML='';
  const map={};
  booked.forEach(b=>map[b.seat]=b.nickname);
  SEATS.forEach(n=>{
    const d=document.createElement('div');
    d.className='seat '+(map[n]?'booked':'empty');
    d.textContent=map[n]||n;
    if(!map[n]){
      d.onclick=()=>{
        document.querySelectorAll('.seat').forEach(s=>s.classList.remove('selected'));
        d.classList.add('selected');
        seatField.value=n;
        formBox.classList.remove('hidden');
      };
    }
    seatGrid.appendChild(d);
  });
}

// --- load booked ---
function loadBooked(date){
  const cb='cb'+Date.now();
  window[cb]=d=>{renderSeats(d.bookings||[]);delete window[cb];};
  const s=document.createElement('script');
  s.src=READ_URL+'&date='+date+'&callback='+cb;
  document.body.appendChild(s);
}

date.onchange=()=>loadBooked(date.value);

// --- initial ---
document.addEventListener('DOMContentLoaded',()=>renderSeats([]));

// --- submit ---
bookingForm.onsubmit=e=>{
  e.preventDefault();
  const btn=submitBtn;
  btn.disabled=true;
  btn.textContent='กำลังบันทึก...';
  fetch(SCRIPT_URL,{
    method:'POST',
    body:new URLSearchParams(new FormData(bookingForm))
  }).then(()=>{
    alert('จองสำเร็จ');
    location.reload();
  });
};
</script>
</body>
</html>
