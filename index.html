
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏£‡∏ñ‡∏ï‡∏π‡πâ</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
/* --- CSS ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡πÑ‡∏≠‡∏ã‡πå --- */
:root{
  --green:#4CAF50; --red:#E53935; --yellow:#FDD835; --bg:#f2f4f7;
  --card:#fff; --muted:#777;
}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto; background:var(--bg); padding:16px;}
.card{max-width:520px;margin:0 auto;background:var(--card);border-radius:14px;padding:18px;box-shadow:0 8px 30px rgba(0,0,0,0.06);}
.title{text-align:center;font-size:22px;font-weight:700;margin:2px 0 6px;}
.subtitle{text-align:center;color:var(--muted);font-size:13px;margin-bottom:12px;}
.logo{display:block;margin:8px auto 12px;max-width:220px;width:70%;}
.seat-map-img{display:block;margin:6px auto 12px;max-width:280px;width:85%;border-radius:8px;}
.field-label{font-weight:600;margin:10px 0 6px;display:block;}
.field-input{width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;box-sizing:border-box;font-size:15px;}
.grid{display:grid;grid-template-columns:repeat(3,90px);gap:12px;justify-content:center;margin-top:14px;margin-bottom:12px;}

.seat{
  width:90px; height:90px; border-radius:12px; display:flex; align-items:center; justify-content:center;
  font-size:17px; font-weight:600; color:#fff; cursor:pointer; padding:4px; line-height:1.2;
  white-space:nowrap; box-shadow:0 6px 14px rgba(0,0,0,0.06); transition:transform .12s;
}
.seat:hover{transform:translateY(-4px)}
.seat.empty{background:var(--green)}
.seat.booked{background:var(--red);cursor:not-allowed;transform:none;box-shadow:none}
.seat.selected{background:var(--yellow);color:#000}

/* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ */
.bank-box { border: 2px dashed #1976d2; border-radius: 12px; padding: 15px; margin: 15px 0; background: #fdfdfd; text-align: center; }
.bank-box p { margin: 5px 0; font-size: 15px; font-weight: 500; }

.legend{display:flex;gap:10px;align-items:center;justify-content:center;margin-top:10px;font-size:13px;color:var(--muted)}
.legend .box{width:14px;height:14px;border-radius:3px;display:inline-block;margin-right:6px}
.btn{display:block;width:100%;padding:14px;border-radius:12px;border:0;background:#1e88e5;color:#fff;font-weight:700;font-size:16px;cursor:pointer;margin-top:15px}
.note{font-size:13px;color:var(--muted);text-align:center;margin-top:12px}
.hidden{display:none}
  </style>
</head>
<body>

<div class="card">
  <h1 class="title">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏£‡∏ñ‡∏ï‡∏π‡πâ</h1>
  <p class="subtitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏¥‡∏õ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ö‡∏≤‡∏∞ ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö</p>

  <img src="‡πÄ‡∏ó‡∏µ‡πà‡∏¢ ‡∏ô‡∏µ‡πà‡πÄ‡∏´‡∏≠‡∏∞.png" class="logo">
  <img src="IMG_0444.jpeg" class="seat-map-img">

  <form id="bookingForm">
    <label class="field-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</label>
    <input id="date" name="date" type="date" class="field-input" required>

    <label class="field-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏¥‡∏õ</label>
    <input id="trip" name="trip" class="field-input" required>

    <div id="seatGrid" class="grid"></div>
    <input id="seatField" name="seat" type="hidden">

    <div id="formBox" class="hidden">
      <label class="field-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
      <input name="name" class="field-input" required>

      <label class="field-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
      <input name="nickname" class="field-input" required>

      <label class="field-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
      <input name="phone" class="field-input" required>

      <label class="field-label">‡πÑ‡∏•‡∏ô‡πå</label>
      <input name="line" class="field-input" required>

      <div class="bank-box">
        <p>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏´‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡∏ò‡∏ô‡∏ä‡∏≤‡∏ï (TTB)</p>
        <p style="font-size:26px;color:#d32f2f;font-weight:800;">442-2-61447-1</p>
        <p>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ç ‡∏ô‡∏≤‡∏Ñ‡∏∞‡∏•‡∏±‡∏¢</p>

        <input name="amount" value="1000" readonly class="field-input" style="margin-top:10px">
        <input type="file" id="slipFile" class="field-input" accept="image/*" required onchange="processFile(this)">
        <input type="hidden" id="slipBase64" name="slipBase64">
      </div>

      <button id="submitBtn" class="btn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ</button>
    </div>
  </form>

  <div class="legend">
    <span><span class="box" style="background:var(--green)"></span>‡∏ß‡πà‡∏≤‡∏á</span>
    <span><span class="box" style="background:var(--yellow)"></span>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
    <span><span class="box" style="background:var(--red)"></span>‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw7OvKq9CZ2bgRI61UpGVTCqYYSm4xSz4DcDwkwEaTXG0yfhldX34Bmnqi5m7y6cnS-/exec";
const READ_URL = SCRIPT_URL + "?action=read";
const SEATS = [3,6,9,2,5,8,1,4,7];

// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏™‡πà‡∏á base64 ‡πÄ‡∏ï‡πá‡∏° ‡πÜ
function processFile(el){
  const file = el.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    document.getElementById('slipBase64').value = reader.result;
  };
  reader.readAsDataURL(file);
}

// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ no-cors
document.getElementById('bookingForm').addEventListener('submit', e=>{
  e.preventDefault();
  if(!slipBase64.value){ alert('‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡πà‡∏≠‡∏ô'); return; }

  const btn = submitBtn;
  btn.disabled = true;
  btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

  const fd = new FormData(e.target);
  fetch(SCRIPT_URL,{
    method:'POST',
    body:new URLSearchParams(fd)
  }).then(()=>{
    alert('‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    location.reload();
  }).catch(()=>{
    alert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
    btn.disabled=false;
    btn.innerText='‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ';
  });
});

// ---- ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ö‡∏≤‡∏∞ (‡πÄ‡∏î‡∏¥‡∏°) ----
function loadBookedJSONP(date, cb){
  const c='cb'+Date.now();
  window[c]=d=>{cb(d.bookings||[]);delete window[c];};
  const s=document.createElement('script');
  s.src=READ_URL+'&date='+date+'&callback='+c;
  document.body.appendChild(s);
}
function renderSeats(b){
  seatGrid.innerHTML='';
  seatField.value='';
  formBox.classList.add('hidden');
  const m={};b.forEach(x=>m[x.seat]=x.nickname);
  SEATS.forEach(n=>{
    const d=document.createElement('div');
    d.className='seat '+(m[n]?'booked':'empty');
    d.textContent=m[n]||n;
    if(!m[n]) d.onclick=()=>{
      document.querySelectorAll('.seat').forEach(s=>s.classList.remove('selected'));
      d.classList.add('selected');
      seatField.value=n;
      formBox.classList.remove('hidden');
    };
    seatGrid.appendChild(d);
  });
}
date.onchange=()=>loadBookedJSONP(date.value,renderSeats);
</script>
</body>
</html>
