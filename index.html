
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏£‡∏ñ‡∏ï‡∏π‡πâ - ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ô‡∏µ‡πà‡πÄ‡∏´‡∏≠‡∏∞ üöê‚ú®</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=IBM+Plex+Sans+Thai:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    /* ===== UI ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏Å‡πâ ===== */
    * { box-sizing: border-box !important; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    body { font-family: 'Inter','IBM Plex Sans Thai',sans-serif; background-color: #f0f4f8; display: flex; justify-content: center; min-height: 100vh; padding: 20px 0; color: #334155; }
    .card { width: 92%; max-width: 400px; background: #ffffff; border-radius: 30px; padding: 25px 20px; box-shadow: 0 15px 30px rgba(0,0,0,0.08); height: fit-content; text-align: center; overflow: hidden; }
    .logo { display:block;margin:0 auto 10px;max-width:150px;height:auto;}
    .title {font-size:24px;font-weight:700;color:#1e40af;margin-bottom:5px;}
    .subtitle {color:#64748b;font-size:13px;margin-bottom:25px;}
    .field-group {margin-bottom:15px;text-align:left;}
    .field-label {font-weight:600;margin-bottom:6px;font-size:14px;color:#1e40af;}
    .field-input {width:100%;padding:12px 15px;border-radius:15px;border:1.5px solid #cbd5e1;font-size:16px;background:#f8fafc;height:54px;}
    .seat-map-img {width:100%;border-radius:15px;margin:15px 0;border:1px solid #eee;}
    .grid {display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:20px 0;padding:12px;background:#f1f5f9;border-radius:25px;}
    .seat {aspect-ratio:1/1;border-radius:18px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;font-weight:700;color:white;}
    .seat.empty {background:linear-gradient(135deg,#10b981,#059669);}
    .seat.booked {background:linear-gradient(135deg,#ef4444,#dc2626);font-size:10px;cursor:not-allowed;}
    .seat.selected {background:linear-gradient(135deg,#fbbf24,#f59e0b);color:#000;}
    .hidden {display:none;}
    .btn {width:100%;padding:18px;border-radius:15px;border:none;background:#2563eb;color:white;font-size:18px;font-weight:700;margin-top:10px;}
    .modal {display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);align-items:center;justify-content:center;}
    .modal-content {background:#fff;padding:25px;border-radius:25px;max-width:380px;width:100%;text-align:center;}
  </style>
</head>
<body>

<div class="card">
  <img src="‡πÄ‡∏ó‡∏µ‡πà‡∏¢ ‡∏ô‡∏µ‡πà‡πÄ‡∏´‡∏≠‡∏∞.png" class="logo">
  <h1 class="title">‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏£‡∏ñ‡∏ï‡∏π‡πâ üöêüí®</h1>
  <p class="subtitle">‡∏à‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏ô‡∏±‡πà‡∏á ‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏ô‡πÑ‡∏õ‡∏ô‡∏∞‡∏à‡πä‡∏∞ ‚ú®</p>

  <div class="field-group">
    <label class="field-label">üìÖ ‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á (‡∏≠‡∏¢‡πà‡∏≤‡∏°‡∏≤‡∏™‡∏≤‡∏¢‡∏ô‡∏∞‡∏Ç‡∏≠‡∏£‡πâ‡∏≠‡∏á)</label>
    <input id="date" type="date" class="field-input">
  </div>

  <div class="field-group">
    <label class="field-label">‚õ∫ ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏¥‡∏õ (‡πÑ‡∏õ‡πÑ‡∏´‡∏ô‡∏ö‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢)</label>
    <input id="trip" type="text" class="field-input">
  </div>

  <img src="IMG_0444.jpeg" class="seat-map-img">
  <div id="seatGrid" class="grid"></div>
  <input type="hidden" id="seatField">

  <div id="formBox" class="hidden">
    <div class="field-group"><label class="field-label">üë§ ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input id="name" class="field-input"></div>
    <div class="field-group"><label class="field-label">üè∑Ô∏è ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label><input id="nickname" class="field-input"></div>
    <div class="field-group"><label class="field-label">üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input id="phone" class="field-input"></div>
    <div class="field-group"><label class="field-label">üí¨ ‡πÑ‡∏•‡∏ô‡πå</label><input id="line" class="field-input"></div>
    <button class="btn" onclick="showPayment()">üöÄ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß...‡πÑ‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô!</button>
  </div>
</div>

<div id="payModal" class="modal">
  <div class="modal-content">
    <input type="checkbox" id="confirmCheck"> ‡πÇ‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß
    <button id="submitBtn" class="btn" onclick="finalSubmit()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏¥‡∏´‡πà‡∏≤‡∏à‡∏¥‡∏Å!</button>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw7OvKq9CZ2bgRI61UpGVTCqYYSm4xSz4DcDwkwEaTXG0yfhldX34Bmnqi5m7y6cnS-/exec";
const READ_URL = SCRIPT_URL + "?action=read";
const SEATS = [3,6,9,2,5,8,1,4,7];
const USER_KEY = Math.random().toString(36).slice(2);
let selectingSeats = [];

function loadBooked(date){
  const cb="cb_"+Date.now();
  window[cb]=res=>{
    selectingSeats = res.selecting || [];
    renderSeats(res.bookings||[]);
    delete window[cb];
  };
  const s=document.createElement("script");
  s.src=`${READ_URL}&date=${date}&callback=${cb}`;
  document.body.appendChild(s);
}

function renderSeats(booked){
  const map={}; booked.forEach(b=>map[b.seat]=b.nickname);
  seatGrid.innerHTML="";
  SEATS.forEach(n=>{
    const d=document.createElement("div");
    const isSelecting = selectingSeats.includes(String(n));
    if(map[n]){
      d.className="seat booked";
      d.innerHTML=`‡πÄ‡∏ö‡∏≤‡∏∞ ${n}<br>${map[n]}`;
    } else if(isSelecting){
      d.className="seat selected";
      d.innerHTML=`‡πÄ‡∏ö‡∏≤‡∏∞<br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å`;
    } else {
      d.className="seat empty";
      d.innerHTML=`‡πÄ‡∏ö‡∏≤‡∏∞<br>${n}`;
      d.onclick=()=>{
        if(!date.value) return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô");
        if(!trip.value.trim()) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏¥‡∏õ‡∏Å‡πà‡∏≠‡∏ô");
        fetch(SCRIPT_URL,{
          method:'POST',
          headers:{'Content-Type':'application/x-www-form-urlencoded'},
          body:new URLSearchParams({action:'select',date:date.value,seat:n,user:USER_KEY}).toString()
        });
        seatField.value=n;
        formBox.classList.remove("hidden");
      };
    }
    seatGrid.appendChild(d);
  });
}

date.onchange=()=>loadBooked(date.value);
setInterval(()=>{ if(date.value) loadBooked(date.value); },4000);

function showPayment(){ payModal.style.display="flex"; }

function finalSubmit(){
  if(!confirmCheck.checked) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡πä‡∏Å");
  fetch(SCRIPT_URL,{
    method:'POST',
    headers:{'Content-Type':'application/x-www-form-urlencoded'},
    body:new URLSearchParams({
      date:date.value,trip:trip.value,seat:seatField.value,
      name:name.value,nickname:nickname.value,phone:phone.value,line:line.value
    }).toString()
  }).then(()=>location.reload());
}
</script>
</body>
</html>
