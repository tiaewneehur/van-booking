
<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<title>จองที่นั่งรถตู้</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{font-family:system-ui;background:#f2f4f7;padding:16px}
.card{max-width:520px;margin:auto;background:#fff;border-radius:14px;padding:18px}
.grid{display:grid;grid-template-columns:repeat(3,90px);gap:12px;justify-content:center}
.seat{height:90px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:600}
.empty{background:#4CAF50;color:#fff;cursor:pointer}
.pending{background:#FDD835}
.booked{background:#E53935;color:#fff}
.hidden{display:none}
</style>
</head>

<body>

<div class="card" id="page-book">
<h3 style="text-align:center">ระบบจองที่นั่ง</h3>

<img src="/เที่ย นี่เหอะ.png" width="200" style="display:block;margin:auto">
<img src="/IMG_0444.jpeg" width="260" style="display:block;margin:auto">

<input type="date" id="date">
<input type="text" id="trip" placeholder="ชื่อทริป">

<div id="seatGrid" class="grid"></div>

<div id="form" class="hidden">
<input id="name" placeholder="ชื่อ-สกุล">
<input id="nickname" placeholder="ชื่อเล่น">
<input id="phone" placeholder="เบอร์">
<input id="line" placeholder="ไลน์">
<button onclick="submitBooking()">ยืนยัน</button>
</div>
</div>

<div class="card hidden" id="page-pay">
<h3>โอนเงินมัดจำ 1,000 บาท</h3>
<p>ธนาคาร TTB</p>
<p>เลขบัญชี 4422614471</p>
<p>ชื่อ วิชาญ นาคะลัย</p>
<p id="timer"></p>
</div>

<script>
const API='YOUR_SCRIPT_URL';
const SEATS=[3,6,9,2,5,8,1,4,7];
let pick=null;

function load(){
  const d=date.value;
  if(!d)return;
  const cb='cb'+Date.now();
  window[cb]=res=>render(res.bookings||[]);
  const s=document.createElement('script');
  s.src=API+'?action=read&date='+d+'&callback='+cb;
  document.body.appendChild(s);
}
date.onchange=load;

function render(data){
  seatGrid.innerHTML='';
  const map={};
  data.forEach(b=>map[b.seat]=b);
  SEATS.forEach(n=>{
    const d=document.createElement('div');
    d.className='seat';
    if(map[n]){
      d.classList.add(map[n].status==='CONFIRMED'?'booked':'pending');
      d.innerHTML=map[n].nickname+(map[n].status==='PENDING'?' <small>รอชำระ</small>':'');
    }else{
      d.classList.add('empty');
      d.textContent=n;
      d.onclick=()=>{pick=n;form.classList.remove('hidden')};
    }
    seatGrid.appendChild(d);
  });
}

function submitBooking(){
  fetch(API,{
    method:'POST',
    body:new URLSearchParams({
      date:date.value,
      trip:trip.value,
      seat:pick,
      name:name.value,
      nickname:nickname.value,
      phone:phone.value,
      line:line.value
    })
  }).then(()=>{
    page-book.classList.add('hidden');
    page-pay.classList.remove('hidden');
    startTimer(1800);
  });
}

function startTimer(sec){
  const t=setInterval(()=>{
    timer.textContent='เหลือเวลา '+Math.floor(sec/60)+':'+(sec%60);
    if(--sec<0)clearInterval(t);
  },1000);
}
</script>

</body>
</html>
