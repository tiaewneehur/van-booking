
<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏£‡∏ñ‡∏ï‡∏π‡πâ</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<style>
:root{
  --green:#4CAF50;
  --red:#E53935;
  --yellow:#FDD835;
  --bg:#f2f4f7;
  --card:#fff;
  --muted:#777;
}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  padding:16px;
}
.card{
  max-width:520px;
  margin:auto;
  background:var(--card);
  border-radius:14px;
  padding:18px;
  box-shadow:0 8px 30px rgba(0,0,0,.06);
}
.title{text-align:center;font-size:22px;font-weight:700}
.subtitle{text-align:center;color:var(--muted);font-size:13px;margin-bottom:12px}
.logo{display:block;margin:10px auto;max-width:220px;width:70%}
.seat-map-img{display:block;margin:10px auto;max-width:280px;width:85%;border-radius:8px}

.field-label{font-weight:600;margin:10px 0 6px;display:block}
.field-input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ddd;
  font-size:15px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(3,90px);
  gap:12px;
  justify-content:center;
  margin:14px 0;
}

.seat{
  width:90px;height:90px;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-size:15px;
  font-weight:600;
  line-height:1.2;
  cursor:pointer;
  color:#fff;
}
.seat.empty{background:var(--green)}
.seat.booked{background:var(--red);cursor:not-allowed}
.seat.pending{background:var(--yellow);color:#000}

.btn{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  font-size:15px;
  font-weight:700;
  color:#fff;
  cursor:pointer;
  margin-top:10px;
}
.btn-main{background:#1976d2}
.btn-line{background:#00c300}

.note{font-size:13px;color:var(--muted);text-align:center;margin-top:8px}
.hidden{display:none}

@media(max-width:420px){
  .grid{grid-template-columns:repeat(3,72px)}
  .seat{width:72px;height:72px;font-size:13px}
}
</style>
</head>

<body>
<div class="card">

<h1 class="title">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏£‡∏ñ‡∏ï‡∏π‡πâ</h1>
<p class="subtitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ö‡∏≤‡∏∞ ‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>

<img src="‡πÄ‡∏ó‡∏µ‡πà‡∏¢ ‡∏ô‡∏µ‡πà‡πÄ‡∏´‡∏≠‡∏∞.png" class="logo">
<img src="IMG_0444.jpeg" class="seat-map-img">

<!-- LINE LOGIN -->
<button type="button" id="lineLoginBtn" class="btn btn-line">
‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ LINE
</button>
<p class="note">‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>

<form id="bookingForm" method="POST" target="_blank">

<label class="field-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</label>
<input type="date" id="date" name="date" class="field-input" required>

<label class="field-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏¥‡∏õ</label>
<input type="text" id="trip" name="trip" class="field-input" required>

<div id="seatGrid" class="grid"></div>
<input type="hidden" id="seatField" name="seat">

<div id="formBox" class="hidden">

<label class="field-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
<input type="text" id="name" name="name" class="field-input" required>

<label class="field-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
<input type="text" id="nickname" name="nickname" class="field-input" required>

<label class="field-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
<input type="tel" id="phone" name="phone" class="field-input" required>

<label class="field-label">LINE</label>
<input type="text" id="line" name="line" class="field-input" required>

<button type="submit" class="btn btn-main">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
<p class="note">üü° ‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞ ‚Ä¢ üî¥ ‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</p>

</div>
</form>
</div>

<script>
/* ===== CONFIG ===== */
const SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbw7OvKq9CZ2bgRI61UpGVTCqYYSm4xSz4DcDwkwEaTXG0yfhldX34Bmnqi5m7y6cnS-/exec";
const READ_URL = SCRIPT_URL + "?action=read";
const SEATS = [3,6,9,2,5,8,1,4,7];

/* ===== LINE LOGIN ===== */
document.getElementById('lineLoginBtn').onclick = () => {
  location.href = SCRIPT_URL + "?action=line_login";
};

/* ===== ‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å LINE ===== */
const q = new URLSearchParams(location.search);
if (q.get('line_name')) {
  document.getElementById('nickname').value = q.get('line_name');
  document.getElementById('line').value = q.get('line_name');
}

/* ===== ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ö‡∏≤‡∏∞ ===== */
function loadSeats(date){
  const cb = "cb"+Date.now();
  window[cb] = res => {
    renderSeats(res.bookings || []);
    delete window[cb];
  };
  const s = document.createElement('script');
  s.src = READ_URL + "&date=" + date + "&callback=" + cb;
  document.body.appendChild(s);
}

/* ===== ‡∏ß‡∏≤‡∏î‡∏ú‡∏±‡∏á‡πÄ‡∏ö‡∏≤‡∏∞ ===== */
function renderSeats(booked){
  const grid = document.getElementById('seatGrid');
  grid.innerHTML = '';
  const map = {};
  booked.forEach(b => map[b.seat] = b);

  SEATS.forEach(n => {
    const d = document.createElement('div');
    d.classList.add('seat');

    if (map[n]) {
      if (map[n].status === 'pending') {
        d.classList.add('pending');
        d.innerHTML = map[n].nickname + "<br><small>‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞</small>";
      } else {
        d.classList.add('booked');
        d.textContent = map[n].nickname;
      }
    } else {
      d.classList.add('empty');
      d.textContent = n;
      d.onclick = () => {
        document.getElementById('seatField').value = n;
        document.getElementById('formBox').classList.remove('hidden');
      };
    }
    grid.appendChild(d);
  });
}

/* ===== EVENTS ===== */
document.getElementById('date').onchange = e => {
  if (e.target.value) loadSeats(e.target.value);
};

document.getElementById('bookingForm').action = SCRIPT_URL;
</script>

</body>
</html>
