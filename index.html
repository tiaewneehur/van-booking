
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>จองที่นั่งรถตู้</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{ --green:#4CAF50; --red:#E53935; --yellow:#FDD835; --bg:#f2f4f7; --card:#fff; --muted:#777; --blue:#1976d2; }
    body{margin:0;font-family:system-ui,-apple-system,sans-serif; background:var(--bg); padding:16px;}
    .card{max-width:500px;margin:0 auto;background:var(--card);border-radius:14px;padding:20px;box-shadow:0 8px 30px rgba(0,0,0,0.06);}
    .title{text-align:center;font-size:22px;margin:0 0 10px;}
    .logo, .seat-map-img{display:block;margin:10px auto;max-width:100%;border-radius:8px;}
    .field-label{font-weight:600;margin:12px 0 5px;display:block;}
    .field-input{width:100%;padding:12px;border-radius:10px;border:1px solid #ddd;box-sizing:border-box;}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:20px 0;}
    .seat{aspect-ratio:1/1;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;cursor:pointer;transition:0.2s;}
    .seat.empty{background:var(--green)}
    .seat.booked{background:var(--red);cursor:not-allowed;}
    .seat.selected{background:var(--yellow);color:#000}
    .payment-box{margin-top:20px;padding:15px;border:2px dashed var(--blue);border-radius:12px;background:#f0f7ff;text-align:center;}
    .bank-acc{font-size:22px;color:#d32f2f;font-weight:bold;margin:5px 0;}
    .btn{display:block;width:100%;padding:15px;border-radius:10px;border:0;background:var(--blue);color:#fff;font-weight:700;cursor:pointer;margin-top:20px}
    .btn:disabled{background:#ccc;}
    .hidden{display:none}
    .legend{display:flex;justify-content:center;gap:15px;font-size:12px;margin-top:15px;}
    .legend-item{display:flex;align-items:center;gap:5px;}
    .box{width:12px;height:12px;border-radius:2px;}
  </style>
</head>
<body>

<div class="card">
  <h2 class="title">จองที่นั่งรถตู้</h2>
  <img src="เที่ย นี่เหอะ.png" class="logo" />
  <img src="IMG_0444.jpeg" class="seat-map-img" />

  <form id="bookingForm" method="POST" target="_blank">
    <label class="field-label">วันที่เดินทาง</label>
    <input id="date" name="date" type="date" class="field-input" required />

    <label class="field-label">ชื่อทริป</label>
    <input id="trip" name="trip" type="text" class="field-input" placeholder="เช่น ดอยหลวงเชียงดาว" required />

    <div id="seatGrid" class="grid"></div>
    <input id="seatField" name="seat" type="hidden" />

    <div id="formBox" class="hidden">
      <label class="field-label">ชื่อ-นามสกุล</label>
      <input name="name" type="text" class="field-input" required />

      <label class="field-label">ชื่อเล่น (แสดงบนผัง)</label>
      <input id="nickname" name="nickname" type="text" class="field-input" required />

      <label class="field-label">เบอร์โทรศัพท์</label>
      <input name="phone" type="tel" class="field-input" required />

      <label class="field-label">ชื่อไลน์</label>
      <input name="line" type="text" class="field-input" required />

      <div class="payment-box">
        <b>TTB: <span class="bank-acc">442-2-61447-1</span></b><br>
        วิชาญ นาคะลัย
        <label class="field-label" style="text-align:left;">ยอดโอน: 1,000 บาท</label>
        <input name="amount" type="hidden" value="1000">
        <label class="field-label" style="text-align:left;color:#d32f2f;">แนบรูปสลิปโอนเงิน *</label>
        <input type="file" class="field-input" accept="image/*" required onchange="processFile(this)">
        <input id="slipBase64" name="slipBase64" type="hidden">
      </div>

      <button type="submit" id="submitBtn" class="btn">ยืนยันการจอง</button>
    </div>
  </form>

  <div class="legend">
    <div class="legend-item"><div class="box" style="background:var(--green)"></div>ว่าง</div>
    <div class="legend-item"><div class="box" style="background:var(--yellow)"></div>เลือก</div>
    <div class="legend-item"><div class="box" style="background:var(--red)"></div>จองแล้ว</div>
  </div>
</div>

<script>
const SCRIPT_URL = "ใส่_URL_ที่_Deploy_จาก_Apps_Script_ตรงนี้";
const SEATS = [3,6,9,2,5,8,1,4,7];

function processFile(el) {
  const file = el.files[0];
  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.textContent = "กำลังโหลดรูป...";
  const reader = new FileReader();
  reader.onloadend = function() {
    document.getElementById('slipBase64').value = reader.result.split(',')[1];
    btn.disabled = false;
    btn.textContent = "ยืนยันการจอง";
  }
  reader.readAsDataURL(file);
}

function loadSeats() {
  const date = document.getElementById('date').value;
  if(!date) return;
  const cb = "cb_" + Date.now();
  window[cb] = function(d) {
    const grid = document.getElementById('seatGrid');
    grid.innerHTML = '';
    const booked = {};
    (d.bookings || []).forEach(b => booked[String(b.seat)] = b.nickname);
    SEATS.forEach(s => {
      const div = document.createElement('div');
      div.className = 'seat ' + (booked[s] ? 'booked' : 'empty');
      div.textContent = booked[s] || s;
      if(!booked[s]) div.onclick = function() {
        document.querySelectorAll('.seat').forEach(x => x.classList.remove('selected'));
        div.classList.add('selected');
        document.getElementById('seatField').value = s;
        document.getElementById('formBox').classList.remove('hidden');
      };
      grid.appendChild(div);
    });
    delete window[cb];
  };
  const s = document.createElement('script');
  s.src = SCRIPT_URL + "?action=read&date=" + date + "&callback=" + cb;
  document.body.appendChild(s);
}

document.getElementById('date').onchange = loadSeats;
document.getElementById('bookingForm').action = SCRIPT_URL;
</script>
</body>
</html>
