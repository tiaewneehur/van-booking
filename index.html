
<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏£‡∏ñ‡∏ï‡∏π‡πâ</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
:root{
  --green:#4CAF50; --red:#E53935; --yellow:#FDD835;
  --bg:#f2f4f7; --card:#fff; --muted:#777;
}
body{margin:0;font-family:system-ui;background:var(--bg);padding:16px}
.card{max-width:520px;margin:auto;background:#fff;border-radius:14px;padding:18px}
.hidden{display:none}
.btn{width:100%;padding:12px;border-radius:10px;border:0;font-weight:700;font-size:15px;cursor:pointer}
.btn-line{background:#00c300;color:#fff}
.btn-main{background:#1976d2;color:#fff}
.btn-warn{background:#fbc02d}
.note{text-align:center;font-size:13px;color:#777;margin-top:8px}

.grid{display:grid;grid-template-columns:repeat(3,90px);gap:12px;justify-content:center;margin:12px 0}
.seat{
  width:90px;height:90px;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  font-weight:600;color:#fff;cursor:pointer;text-align:center
}
.seat.empty{background:var(--green)}
.seat.pending{background:var(--yellow);color:#000}
.seat.booked{background:var(--red);cursor:not-allowed}
</style>
</head>

<body>

<!-- üîê LOGIN -->
<div id="loginGate" class="card">
  <h3 style="text-align:center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
  <button id="lineLoginBtn" class="btn btn-line">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ LINE</button>
</div>

<!-- üì¶ MAIN APP -->
<div id="app" class="hidden">

<div class="card">
<h3 style="text-align:center">‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏£‡∏ñ‡∏ï‡∏π‡πâ</h3>

<label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</label>
<input type="date" id="date" style="width:100%;padding:10px">

<label>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏£‡∏¥‡∏õ</label>
<input type="text" id="trip" style="width:100%;padding:10px">

<div id="seatGrid" class="grid"></div>

<div id="formBox" class="hidden">
<label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
<input id="nickname" style="width:100%;padding:10px">

<label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
<input id="phone" style="width:100%;padding:10px">

<button class="btn btn-main" onclick="confirmBooking()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
</div>
</div>

</div>

<!-- üí∞ PAYMENT -->
<div id="paymentPage" class="hidden">
<div class="card">
<h3 style="text-align:center">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥</h3>

<p style="text-align:center;font-size:18px">
‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞ <b>1,000 ‡∏ö‡∏≤‡∏ó</b>
</p>

<p style="text-align:center">
‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ TTB<br>
‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ <b>442-261-4471</b><br>
‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ç ‡∏ô‡∏≤‡∏Ñ‡∏∞‡∏•‡∏±‡∏¢
</p>

<img src="PROMPTPAY_QR.png" style="width:200px;display:block;margin:auto">

<p class="note">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÇ‡∏≠‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô <span id="timer">30:00</span></p>

<button class="btn btn-warn" onclick="notifyPaid()">‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</button>
</div>
</div>

<script>
/* ===== CONFIG ===== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw7OvKq9CZ2bgRI61UpGVTCqYYSm4xSz4DcDwkwEaTXG0yfhldX34Bmnqi5m7y6cnS-/exec";
const READ_URL = SCRIPT_URL + "?action=read";
const SEATS = [3,6,9,2,5,8,1,4,7];
let selectedSeat=null;
let bookingKey=null;

/* ===== LOGIN ===== */
document.getElementById('lineLoginBtn').onclick=()=>{
  location.href=SCRIPT_URL+"?action=line_login";
};
const q=new URLSearchParams(location.search);
if(q.get('line_name')){
  document.getElementById('loginGate').classList.add('hidden');
  document.getElementById('app').classList.remove('hidden');
  document.getElementById('nickname').value=q.get('line_name');
}

/* ===== LOAD SEATS ===== */
function loadSeats(date){
  const cb="cb"+Date.now();
  window[cb]=res=>{
    renderSeats(res.bookings||[]);
    delete window[cb];
  };
  const s=document.createElement('script');
  s.src=READ_URL+"&date="+date+"&callback="+cb;
  document.body.appendChild(s);
}

function renderSeats(booked){
  const grid=document.getElementById('seatGrid');
  grid.innerHTML='';
  const map={};
  booked.forEach(b=>map[b.seat]=b);
  SEATS.forEach(n=>{
    const d=document.createElement('div');
    d.className='seat';
    if(map[n]){
      d.classList.add(map[n].status==='paid'?'booked':'pending');
      d.innerHTML=map[n].nickname+(map[n].status!=='paid'?'<br><small>‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞</small>':'');
    }else{
      d.classList.add('empty');
      d.textContent=n;
      d.onclick=()=>{
        selectedSeat=n;
        document.getElementById('formBox').classList.remove('hidden');
      };
    }
    grid.appendChild(d);
  });
}

document.getElementById('date').onchange=e=>{
  if(e.target.value) loadSeats(e.target.value);
};

/* ===== BOOKING ===== */
function confirmBooking(){
  fetch(SCRIPT_URL,{
    method:'POST',
    body:new URLSearchParams({
      date:date.value,
      trip:trip.value,
      seat:selectedSeat,
      nickname:nickname.value,
      phone:phone.value
    })
  }).then(r=>r.text()).then(()=>{
    document.getElementById('app').classList.add('hidden');
    document.getElementById('paymentPage').classList.remove('hidden');
    startTimer(30*60);
  });
}

/* ===== PAYMENT ===== */
function startTimer(sec){
  const el=document.getElementById('timer');
  const t=setInterval(()=>{
    const m=Math.floor(sec/60);
    const s=sec%60;
    el.textContent=`${m}:${String(s).padStart(2,'0')}`;
    if(--sec<0) clearInterval(t);
  },1000);
}

function notifyPaid(){
  alert("‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö");
}
</script>

</body>
</html>
